
Property changes on: .
___________________________________________________________________
Name: svn:ignore
   + .classpath
.settings
.project


Index: src/server-java/webcontainer/nextapp/echo/webcontainer/resource/RemoteClient.js
===================================================================
--- src/server-java/webcontainer/nextapp/echo/webcontainer/resource/RemoteClient.js	(revision 1220)
+++ src/server-java/webcontainer/nextapp/echo/webcontainer/resource/RemoteClient.js	(working copy)
@@ -46,6 +46,13 @@
     },
     
     /**
+     * Listeners to be notified of remote client events.
+     * @private
+     * @type Core.ListenerList
+     */
+    _listenerList: null,
+    
+    /**
      * The base server url.
      * @type String
      * @private
@@ -144,6 +151,7 @@
         Echo.Client.call(this);
         
         this._serverUrl = serverUrl;
+        this._listenerList = new Core.ListenerList();
         this._processClientUpdateRef = Core.method(this, this._processClientUpdate);
         this._processClientEventRef = Core.method(this, this._processClientEvent);
         this._urlMappings = {};
@@ -170,6 +178,17 @@
     },
     
     /**
+     * Adds a listener to be notified when a server update has been
+     * completely processed, that is, all component and rendering
+     * updates have been completed.
+     * 
+     * @param {Function} l the listener to add
+     */
+    addServerUpdateCompleteListener: function(l) {
+        this._listenerList.addListener("serverUpdateComplete", l);
+    },
+    
+    /**
      * Decompresses a shorthand URL into a valid full-length URL.
      * A shorthand URL is expressed as "!A!xxxx" where
      * "A" is a key whose value contains the first portion of the URL
@@ -384,6 +403,10 @@
             this._waitIndicatorActive = false;
             this._waitIndicator.deactivate();
         }
+        
+        if (this._listenerList.hasListeners("serverUpdateComplete")) {
+            this._listenerList.fireEvent({type: "serverUpdateComplete"});
+        }
     },
     
     /**
@@ -439,8 +462,17 @@
     removeComponentListener: function(component, eventType) {
         component.removeListener(eventType, this._processClientEventRef);
     },
-    
+        
     /**
+     * Removes a ServerUpdateCompleteListener.
+     * 
+     * @param {Function} l the listener to remove
+     */
+    removeServerUpdateCompleteListener: function(l) {
+        this._listenerList.removeListener("serverUpdateComplete", l);
+    },
+
+    /**
      * Sets the wait indicator that will be displayed when a client-server action takes longer than
      * a specified period of time.
      * 
Index: src/server-java/webcontainer/nextapp/echo/webcontainer/WebContainerServlet.java
===================================================================
--- src/server-java/webcontainer/nextapp/echo/webcontainer/WebContainerServlet.java	(revision 1220)
+++ src/server-java/webcontainer/nextapp/echo/webcontainer/WebContainerServlet.java	(working copy)
@@ -41,9 +41,11 @@
 
 import java.io.IOException;
 import java.util.ArrayList;
+import java.util.HashSet;
 import java.util.Iterator;
 import java.util.List;
 
+import java.util.Set;
 import javax.servlet.ServletException;
 import javax.servlet.http.HttpServlet;
 import javax.servlet.http.HttpServletRequest;
@@ -388,5 +390,22 @@
             activeConnection.set(null);
         }
     }
+   
+    private Set cssFileNames = new HashSet();
     
-}
+    /**
+     * Adds a css file name to be added to the window html.
+     */
+    public void addCssFileName(String cssFileName) {
+        cssFileNames.add(cssFileName);
+    }
+    
+    /**
+     * Returns an iterator over the CSS file names.
+     * @return
+     */
+    public Iterator getCssFileNames() {
+        return cssFileNames.iterator();
+    }
+    
+}
\ No newline at end of file
Index: src/server-java/webcontainer/nextapp/echo/webcontainer/service/WindowHtmlService.java
===================================================================
--- src/server-java/webcontainer/nextapp/echo/webcontainer/service/WindowHtmlService.java	(revision 1220)
+++ src/server-java/webcontainer/nextapp/echo/webcontainer/service/WindowHtmlService.java	(working copy)
@@ -104,6 +104,21 @@
         styleElement.setAttribute("type", "text/css");
         styleElement.appendChild(document.createTextNode(" "));
         headElement.appendChild(styleElement);
+        
+        WebContainerServlet servlet = conn.getServlet();
+        
+        Iterator cssIt = servlet.getCssFileNames();
+        if (cssIt != null) {
+            while(cssIt.hasNext()) {
+                String cssFileName = (String) cssIt.next();
+                Element additionalStyleElement = document.createElement("link");
+                additionalStyleElement.setAttribute("href", cssFileName);
+                additionalStyleElement.setAttribute("type", "text/css");
+                additionalStyleElement.setAttribute("rel", "stylesheet");
+                additionalStyleElement.appendChild(document.createTextNode(" "));
+                headElement.appendChild(additionalStyleElement);
+            }
+        }
 
         Element scriptElement = document.createElement("script");
         Text textNode = document.createTextNode(" ");
@@ -111,8 +126,8 @@
         scriptElement.setAttribute("type", "text/javascript");
         scriptElement.setAttribute("src", userInstance.getServiceUri(BootService.SERVICE));
         headElement.appendChild(scriptElement);
+
         
-        WebContainerServlet servlet = conn.getServlet();
         Iterator scriptIt = servlet.getStartupScripts();
         if (scriptIt != null) {
             while (scriptIt.hasNext()) {

Property changes on: src/client/echo
___________________________________________________________________
Name: svn:ignore
   + .Render.ContentPane.js.swp


Index: src/client/echo/Render.js
===================================================================
--- src/client/echo/Render.js	(revision 1220)
+++ src/client/echo/Render.js	(working copy)
@@ -30,6 +30,23 @@
      * @type Object
      */
     _disposedComponents: null,
+
+        
+    /**
+     * Listeners to be notified of rendering phase events.
+     * @type Core.ListenerList
+     */
+    _listenerList: new Core.ListenerList(),
+
+    /**
+     * Adds a listener to be notified when the renderDisplay
+     * phase of an update has been completed.
+     * 
+     * @param {Function} l the listener to add
+     */
+    addRenderDisplayCompleteListener: function(l) {
+        Echo.Render._listenerList.addListener("renderDisplayComplete", l);
+    },
     
     //FIXME.  Scrollbar position tracking code in SplitPane appears to suggest that
     // disposed states are not in good shape....SplitPane is being disposed when
@@ -262,6 +279,11 @@
                 Echo.Render._doRenderDisplay(updates[i].parent, true);
             }
         }
+
+	// call any listeners that want to know when when the render display phase is finished
+        if (Echo.Render._listenerList.hasListeners("renderDisplayComplete")) {
+            Echo.Render._listenerList.fireEvent({type: "renderDisplayComplete"});
+        }
     
         // Profiling: Mark completion of display phase.
         if (Echo.Client.profilingTimer) {
@@ -298,6 +320,15 @@
         }
         this._peers[componentName] = peerObject;
     },
+
+    /**
+     * Removes a renderDisplayCompleteListener.
+     * 
+     * @param {Function} l the listener to remove
+     */
+    removeRenderDisplayCompleteListener: function(l) {
+        this._listenerList.removeListener("renderDisplayComplete", l);
+    },
     
     /**
      * Renders a new component inside of a DOM element.
Index: src/client/echo/Application.js
===================================================================
--- src/client/echo/Application.js	(revision 1220)
+++ src/client/echo/Application.js	(working copy)
@@ -1026,8 +1026,9 @@
             if (this._style != null) {
                 value = this._style[name];
             }
-            if (value == null && this._styleName && this.application && this.application._styleSheet) {
-                var style = this.application._styleSheet.getRenderStyle(this._styleName, this.componentType);
+            if (value == null && this.application && this.application._styleSheet) {
+                var style = this.application._styleSheet.getRenderStyle(
+                    this._styleName != null ? this._styleName : "", this.componentType);
                 if (style) {
                     value = style[name];
                 }
@@ -1056,7 +1057,8 @@
                 value = valueArray ? valueArray[index] : null;
             }
             if (value == null && this._styleName && this.application && this.application._styleSheet) {
-                var style = this.application._styleSheet.getRenderStyle(this._styleName, this.componentType);
+                var style = this.application._styleSheet.getRenderStyle(
+                    this._styleName != null ? this._styleName : "", this.componentType);
                 if (style) {
                     valueArray = style[name];
                     value = valueArray ? valueArray[index] : null;
Index: build.xml
===================================================================
--- build.xml	(revision 1220)
+++ build.xml	(working copy)
@@ -422,5 +422,39 @@
         <gzip src="${dir.release}/${tarfile.release}" zipfile="${dir.release}/${tgzfile.release}"/>
         <delete file="${dir.release}/${tarfile.release}"/>
     </target>
+	
+	<target name="mvn-install-win"
+			depends="dist"
+			description="Installs the jars into the local maven repository (windows environment)">
+		<exec executable="cmd">
+			<arg value="/c"/>
+			<arg value="mvn install:install-file -DgroupId=com.nextapp -DartifactId=echo3-app -Dversion=1.0-SNAPSHOT -Dpackaging=jar -Dfile=dist${file.separator}lib${file.separator}Echo3_App.jar"/>
+		</exec>
+		<exec executable="cmd">
+			<arg value="/c"/>
+			<arg value="mvn install:install-file -DgroupId=com.nextapp -DartifactId=echo3-webcontainer -Dversion=1.0-SNAPSHOT -Dpackaging=jar -Dfile=dist${file.separator}lib${file.separator}Echo3_WebContainer.jar"/>
+		</exec>
+	</target>
+	
+	<target name="mvn-install-unix"
+			depends="dist"
+			description="Installs the jar into the local maven repository">
+		<exec executable="mvn">
+			<arg value="install:install-file"/>
+			<arg value="-DgroupId=com.nextapp"/>
+			<arg value="-DartifactId=echo3-app"/>
+			<arg value="-Dversion=1.0-SNAPSHOT"/>
+			<arg value="-Dpackaging=jar"/>
+			<arg value="-Dfile=dist${file.separator}lib${file.separator}Echo3_App.jar"/>
+		</exec>
+		<exec executable="mvn">
+			<arg value="install:install-file"/>
+			<arg value="-DgroupId=com.nextapp"/>
+			<arg value="-DartifactId=echo3-webcontainer"/>
+			<arg value="-Dversion=1.0-SNAPSHOT"/>
+			<arg value="-Dpackaging=jar"/>
+			<arg value="-Dfile=dist${file.separator}lib${file.separator}Echo3_WebContainer.jar"/>
+		</exec>
+	</target>
     
 </project>
